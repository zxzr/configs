function getQueryString(a,b){var e,c=new RegExp("(^|&)"+b+"=([^&]*)(&|$)","i"),d=a.indexOf("?");return a=a.substring(d+1),e=a.match(c),null!=e?unescape(e[2]):null}function getRandom(a){return Math.floor(Math.random()*a+1)}function focusOrCreateTab(a){chrome.windows.getAll({populate:!0},function(b){var d,e,f,g,c=null;for(d in b){e=b[d].tabs;for(f in e)if(g=e[f],g.url==a){c=g;break}}c?chrome.tabs.update(c.id,{selected:!0}):chrome.tabs.create({url:a,selected:!0})})}function S4(){return(0|65536*(1+Math.random())).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}function myBrowser(){var b,a=navigator.userAgent.toLowerCase();return a.indexOf("chrome")>-1?(b=_mime("type","application/vnd.chromium.remoting-viewer"),b?"360":a.indexOf("metasr")>-1?"sougou":a.indexOf("lbbrowser")>-1?"liebao":a.indexOf("bidubrowser")>-1?"baidu":a.indexOf("ubrowser")>-1?"uc":a.indexOf("qqbrowser")>-1?"qq":a.indexOf("2345explorer")>-1?"2345":a):void 0}function _mime(a,b){var d,c=navigator.mimeTypes;for(d in c)if(c[d][a]==b)return!0;return!1}function getVal(a){return localStorage[a]}function setVal(a,b){return localStorage[a]=b}(""==getVal("uid")||null==getVal("uid")||void 0==getVal("uid"))&&(localStorage.uid=guid()),localStorage.version=chrome.app.getDetails().version,localStorage.winOpenName="_play",localStorage.host="http://play.ufanw.com/view.html",flag=!1,chrome.tabs.onUpdated.addListener(function(a,b){void 0!=b.url&&($.isEmptyObject(localStorage.getItem("guid"))?localStorage.setItem("guid",guid()):$.isEmptyObject(sessionStorage.getItem("online"))&&(sessionStorage.setItem("online","yes"),$.get("http://jx.ufanw.com/api/GetOnline.ashx?guid="+localStorage.getItem("guid")+"&version="+chrome.app.getDetails().version+"&package=VIP-"+myBrowser())))}),chrome.runtime.onMessage.addListener(function(a,b,c){"weburl"==a.type?$.ajax({type:"get",url:a.url,dataType:a.dataType,async:!1,success:function(b){c({msg:"ok",data:b,url:a.url})}}):"webcoupon"==a.type?$.ajax({type:"get",url:a.url.split(",")[0],dataType:a.dataType,async:!1,success:function(b){c({msg:"ok",data:b,url:a.url,activity_id:a.url.split(",")[1]})}}):"webhtml"==a.type?$.ajax({type:"POST",url:a.url,dataType:a.dataType,data:a.data,async:!1,success:function(b){c({msg:"ok",data:b,url:a.url})}}):"webppp"==a.type&&$.ajax({type:"POST",url:a.url,dataType:a.dataType,data:a.data+"&data=datetime.now",async:!1,success:function(b){c({msg:"ok",data:b,url:a.url})}})}),chrome.extension.onRequest.addListener(function(a,b,c){if("setJujilink"==a.type)setVal("jujiLink_web",a.urlArr),c({msg:"ok"});else if("xhr"==a.type){var d=new XMLHttpRequest;d.open("GET",a.url,!1),d.onreadystatechange=function(){4==d.readyState&&(console.log("\u94fe\u63a5\u83b7\u53d6\u6210\u529f"),c({msg:"ok",data:d.responseText}))},d.send()}else"jump"==a.type?(setVal("url",a.url),setVal("title",a.title),chrome.tabs.update({url:"./play.html"})):"getvalue"==a.type&&c({msg:getVal(a.key),v:chrome.app.getDetails().version,host:getVal("host")})}),chrome.extension.onRequest.addListener(function(a,b,c){"getSetting"==a.action?c(getSetting()):"getValue"==a.action?c(getVal(a.data)):"setValue"==a.action?c(setVal(a.data,a.data1)):"getVersion"==a.action&&c(chrome.app.getDetails().version)}),chrome.runtime.onMessage.addListener(function(a,b,c){switch(a.type){case"gajax":return $.ajax({type:"GET",url:a.url,success:function(a){c({msg:"ok",data:a})},error:function(){c({msg:"error",data:null})}}),!0;case"pajax":return $.ajax({type:"POST",url:a.url,data:a.postdata,success:function(a){c({msg:"ok",data:a})},error:function(){c({msg:"error",data:null})}}),!0;case"cookie":return chrome.cookies.get({url:a.url,name:a.name},function(a){null!=a?c({msg:"ok",data:a.value}):c({msg:"error"})}),!0;case"setting":return c({hidePlugin:window.localStorage.hidePlugin,keyPlugin:window.localStorage.keyPlugin,dwzServer:window.localStorage.dwzServer,applyReason:window.localStorage.applyReason,uuid:window.localStorage.uuid}),!0}}),chrome.browserAction.onClicked.addListener(function(){var b=chrome.extension.getURL("../popup.html");focusOrCreateTab(b)}),chrome.runtime.onInstalled.addListener(function(a){if("install"==a.reason){chrome.tabs.create({url:"./popup.html",active:!0});var b=new XMLHttpRequest;b.open("GET","http://jx.ufanw.com/InstallStatistics.ashx?type=install&package=VIP&v="+chrome.app.getDetails().version,!0),b.send()}else"update"==a.reason}),chrome.runtime.setUninstallURL&&chrome.runtime.setUninstallURL("http://jx.ufanw.com/InstallStatistics.ashx?type=uninstall&package=VIP&v="+chrome.app.getDetails().version),!function(){chrome.app.getDetails(),$.get("http://admin.ufanw.com/api/GetNotice.ashx?type=99&version="+chrome.app.getDetails().version).success(function(a){var b=JSON.parse(a);b.bol&&chrome.notifications.create("update,"+b.url,{type:"basic",iconUrl:chrome.extension.getURL("/img/vip.png"),title:"\u300a\u6709\u8303\u5168\u7f51\u901a\u300b\u6709\u7248\u672c\u66f4\u65b0\u0021",message:b.message},function(){})})}(),chrome.notifications.onClicked.addListener(function(a){"update"==a.split(",")[0]&&chrome.tabs.create({url:a.split(",")[1]}),chrome.notifications.clear(a)});