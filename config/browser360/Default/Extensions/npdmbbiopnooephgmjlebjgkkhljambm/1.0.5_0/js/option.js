"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){function a(a){k.getAsync(l,function(b){for(var c in m)m.hasOwnProperty(c)&&void 0===b[c]&&(b[c]=m[c]);m=b,a&&a(b)},m)}var b=function(){function a(){_classCallCheck(this,a),this.handlers={}}return _createClass(a,[{key:"_addEventListener",value:function(a,b){(this.handlers[a]||(this.handlers[a]=[])).push(b)}},{key:"fire",value:function(a,b){if(this.handlers[a])for(var c=this.handlers[a],d=c.length,e=0;d>e;e++){var f=c[e];f&&f(b)}}},{key:"on",value:function(a,b){var c=Object.prototype.toString.call(a);if("[object String]"==c)this._addEventListener(a,b);else if("[object Array]"==c)for(var d=0,e=a.length;e>d;d++)this._addEventListener(a[d],b);else{if("[object Object]"!=c)throw Error("arguments error");for(var f in a)a.hasOwnProperty(f)&&this._addEventListener(f,a[f])}}},{key:"un",value:function(a,b){this.handlers[a]&&this.handlers[name].filer(function(a){return a!=b})}}]),a}(),c=new(function(){function a(){_classCallCheck(this,a),this._contentEventManager=null,this._extensionEventManger=null}return _createClass(a,[{key:"extensionEventManger",get:function(){return this._extensionEventManger},set:function(a){this._extensionEventManger=a}},{key:"contentEventManager",set:function(a){this._contentEventManager=a},get:function(){return this._contentEventManager}}]),_createClass(a,[{key:"_addContentLister",value:function(){var a=this;this.contentEventManager=new b,chrome.extension.onMessage.addListener(function(b,c,d){var e=b.type,f=b.data;a.contentEventManager&&a.contentEventManager.fire(e,{data:f,resp:d})})}},{key:"_addExtensionLister",value:function(){this.extensionEventManger=new b}},{key:"sendToExtension",value:function(a,b,c){chrome.extension.sendMessage({type:a,data:b},c)}},{key:"sendToContent",value:function(a,b,c,d){chrome.tabs.sendMessage(a,{type:b,data:c},d)}},{key:"addContentLister",value:function(a,b){this.contentEventManager||this._addContentLister(),this.contentEventManager.on(a,b)}},{key:"addExtensionLister",value:function(a,b){this.extensionEventManger||this._addExtensionLister(),this.extensionEventManger.on(a,b)}}]),a}()),d=new(function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"ready",value:function b(a){var b=!1,c=function(){b||(b=!0,a())};"complete"==document.readyState?a():(this.addListener(window,"DOMContentLoaded",c),this.addListener(window,"load",c))}},{key:"getAttr",value:function(a,b){return a.getAttribute(b)}},{key:"setStyles",value:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])}},{key:"show",value:function(a,b){"[object array]"!=Object.prototype.toString.call(a).toLowerCase()&&(a=[a]);for(var c=0;c<a.length;c++)this.setStyles(a[c],{display:b||"block"})}},{key:"hide",value:function(a,b){"[object array]"!=Object.prototype.toString.call(a).toLowerCase()&&(a=[a]);for(var c=0;c<a.length;c++)this.setStyles(a[c],{display:b||"none"})}},{key:"findParent",value:function(a,b){for(var c=a.parentNode;c!=document.body&&-1===(c.className||"").indexOf(b);)c=c.parentNode;return c}},{key:"queryAll",value:function(a){return document.querySelectorAll(a)}},{key:"query",value:function(a,b){return b=b||document,b.querySelector(a)}},{key:"html",value:function(a){return a.innerHTML}},{key:"setText",value:function(a,b){a.innerText=b}},{key:"addListener",value:function(a,b,c){a.addEventListener(b,c)}}]),a}()),e=function(a){function b(a,c,e){_classCallCheck(this,b);var f=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return f.container=d.query(a),f.EVENTS={CHANGE:"change"},f.options=e||{},f.list=f._normalize(c),f.container.innerHTML=new t(f.options.tpl).render({list:f.list}),f._bindEvents(),f}return _inherits(b,a),_createClass(b,[{key:"_bindEvents",value:function(){var a=this;d.addListener(this.container,"click",function(b){var c=b.srcElement,e=c.className;/radio-label/.test(e)?(b.preventDefault(),a.selected(d.getAttr(c,"value"))):/ico-radio/.test(e)&&(b.preventDefault(),c=d.findParent(c,"radio-label"),a.selected(d.getAttr(c,"value")))})}},{key:"_normalize",value:function(a){var b=Object.prototype.toString.call(a),c=[];if("[object Array]"==b){var d=a.length,e=Object.prototype.toString.call(a[0]);if("[object String]"==e)for(var f=0;d>f;f++)c.push({name:a[f],value:f});else c=a}else for(var g in a)a.hasOwnProperty(g)&&c.push({name:a[g],value:g});return c}},{key:"selected",value:function(a){var b=d.query("#radio_level"),c=d.queryAll(".radio-label");b.setAttribute("value",a);for(var e=0;e<c.length;e++){var f=c[e],g=d.getAttr(f,"value");g==a?f.className="radio-label active":f.className="radio-label"}this.fire(this.EVENTS.CHANGE,this.getSelected())}},{key:"getSelected",value:function(){var a=d.query(".radio-label.active");return a.getAttribute("value")}}]),b}(b),f=function(a){function b(a,c,e,f){_classCallCheck(this,b);var g=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return g.container=d.query(a),g.ruleTpl=d.query("#rule_tpl").innerHTML,g.btn=d.query(".btn-add",g.container),g.ipt=d.query(".ipt-rule",g.container),g.list=d.query(".list",g.container),g._bindEvents(),g}return _inherits(b,a),_createClass(b,[{key:"checkIpt",value:function(){var a=(this.ipt.value||"").trim();0==a.length?this.btn.setAttribute("disabled","disabled"):this.btn.removeAttribute("disabled")}},{key:"show",value:function(){d.show(this.container)}},{key:"renderList",value:function(a){this.list.innerHTML=new t(this.ruleTpl).render({list:a||[]})}},{key:"_bindEvents",value:function(){var a=this;d.addListener(this.list,"click",function(b){b.preventDefault();var c=b.srcElement,e=c.className;if("btn-del"==e){b.preventDefault();var f=d.findParent(c,"rule-item"),g=c.getAttribute("data-rule");d.hide(f),a.fire("del",g)}}),d.addListener(this.btn,"click",function(b){b.preventDefault(),a.fire("add",(a.ipt.value||"").trim())}),d.addListener(this.ipt,"keyup",function(b){var c=b.keyCode,d=(a.ipt.value||"").trim();13==c&&d.length>0?a.fire("add",d):a.checkIpt()})}}]),b}(b),g={},h={},i=!0,j=!!chrome.storage;!function(){try{i=!!window.localStorage}catch(a){i=!1}}();var k=new(function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"getSync",value:function(a,b){return i?localStorage[a]||b:g[a]||b}},{key:"setSync",value:function(a,b){if(i)return localStorage[a]=b;var c=Object.prototype.toString.call(b);switch(c){case"[object Object]":case"[object Array]":b=JSON.stringify(b);break;default:b+=""}g[a]=b}},{key:"remSync",value:function(a){i?localStorage.removeItem(a):delete g[a]}},{key:"getAsync",value:function(a,b,c){j?chrome.storage.local.get(a,function(d){window.__IS_DEBUG_MODE__&&console.log("getAsync",{key:a,val:d[a]});var e=(d||{})[a];b&&b(void 0!==e?e:c)}):b&&b(void 0!==h[a]?h[a]:c)}},{key:"setAsync",value:function(a,b,c){if(window.__IS_DEBUG_MODE__&&console.log("setAsync",{key:a,val:b}),j){var d={};d[a]=b,chrome.storage.local.set(d,c)}else h[a]=b,c&&c(b)}},{key:"remAsync",value:function(a,b){j?chrome.storage.local.remove(a,b):delete h[a]}}]),a}());window.__IS_DEBUG_MODE__=!1;var l="storage_key_settings",m={isFirstRun:!0,badgeEnable:!0,level:void 0,whiteRule:[],blackRule:[]};d.ready(function(){function b(a){var b=d.query(".level-close");"0"==a?d.show(b,"inline-block"):d.hide(b)}function g(a){o=new e(".level-list",[{name:"\u5173\u95ed\u62e6\u622a",value:"0",status:"0"==a?"active":"",des:"",className:"level-close"},{name:"\u666e\u901a\u62e6\u622a",value:"1",status:"1"==a?"active":"",des:"\u62e6\u622a\u5f39\u7a97\u5e7f\u544a\u3001\u6a2a\u5e45\u5e7f\u544a\u3001\u8054\u76df\u5e7f\u544a\u7b49",className:"level-normal"},{name:"\u5f3a\u529b\u62e6\u622a",value:"2",status:"2"==a?"active":"",des:"\u5728\u666e\u901a\u62e6\u622a\u7684\u57fa\u7840\u4e0a\uff0c\u5f3a\u529b\u62e6\u622a\u6240\u6709\u5e7f\u544a",className:"level-strong"}],{tpl:j}),b(a),o.on("change",function(a){b(a),c.sendToExtension("setLevel",a)})}function h(a){p.renderList(a.whiteRule),q.renderList(a.blackRule),c.sendToExtension("storeWhite",a.whiteRule),c.sendToExtension("storeBlack",a.blackRule)}function i(){c.sendToExtension("getNativeConfig","",function(a){g(a.level),h(a),a.enableBlack&&q.show()}),a(function(a){var b=a.badgeEnable,c=d.query(".chk-badge .ico");b?c.className="ico ico-chk active":c.className="ico ico-chk"})}var j=d.query("#level_tpl").innerHTML,k=d.query(".ipt-rule-white"),l=d.query(".ipt-rule-black"),m=d.query(".chk-badge"),n=d.query(".chk-badge .ico"),o=void 0,p=new f(".white-container"),q=new f(".black-container");p.on("del",function(a){c.sendToExtension("delWhite",{url:a},function(a){})}),p.on("add",function(a){c.sendToExtension("addWhite",{url:a},function(a){"success"==a&&(k.value="")})}),q.on("del",function(a){c.sendToExtension("delBlack",{url:a},function(a){})}),q.on("add",function(a){c.sendToExtension("addBlack",{url:a},function(a){"success"==a&&(l.value="")})}),chrome.extension.onMessage.addListener(function(a,b,d){var e=a.type;switch(e){case"onWhiteRuleChanged":case"onBlackRuleChanged":c.sendToExtension("getNativeConfig","",function(a){h(a)})}return!0}),d.addListener(m,"click",function(a){a.preventDefault();var b=/active/.test(n.className);b?n.className="ico ico-chk":n.className="ico ico-chk active",c.sendToExtension("enableBadgeText",!b)}),i(),p.checkIpt(),q.checkIpt()})}();